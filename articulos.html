<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artículos - InquisERCO</title>
    <style>
        :root { --primary: #0296c2; --secondary: #0066a1; --accent: #00b4e5; --text: #262626; --muted: #f2f7fb; --border: #d9e5f0; }
        * { box-sizing: border-box; }
        body { font-family: "Helvetica Neue", Arial, sans-serif; background: #eef2f6; color: var(--text); margin: 0; padding: 24px; }
        h1, h2, h3 { margin: 0; font-weight: 700; letter-spacing: 0.2px; }
        .page { max-width: 960px; margin: 0 auto; background: white; padding: 32px; box-shadow: 0 18px 40px rgba(15, 23, 42, 0.15); border-radius: 12px; }
        .top-bar { display: flex; align-items: center; justify-content: space-between; border-bottom: 3px solid var(--secondary); padding-bottom: 18px; margin-bottom: 18px; }
        .brand { display: flex; align-items: center; gap: 12px; }
        .brand-mark { width: 46px; height: 46px; background: linear-gradient(135deg, var(--secondary), var(--accent)); border-radius: 50%; display: grid; place-items: center; color: white; font-weight: 800; font-size: 22px; letter-spacing: 1px; }
        .brand-name { display: flex; flex-direction: column; gap: 4px; }
        .brand-name small { text-transform: uppercase; font-size: 12px; color: #4a5568; letter-spacing: 1px; }
        nav { display: flex; gap: 12px; margin-top: 8px; flex-wrap: wrap; }
        nav a { text-decoration: none; padding: 10px 14px; border-radius: 8px; border: 1px solid var(--border); color: var(--secondary); font-weight: 700; background: #f8fbff; }
        nav a.active { background: linear-gradient(135deg, var(--secondary), var(--accent)); color: white; border-color: transparent; }
        .section-title { background: var(--secondary); color: white; padding: 10px 14px; text-transform: uppercase; font-size: 13px; letter-spacing: 0.5px; border-radius: 8px 8px 0 0; }
        .info-card { border: 1px solid var(--border); border-top: 0; border-radius: 0 0 8px 8px; padding: 14px 16px 10px; margin-bottom: 18px; }
        .mini-form label { font-size: 12px; font-weight: 700; color: #4a5568; display: block; margin-bottom: 4px; }
        .mini-form input { width: 100%; padding: 8px 10px; border-radius: 7px; border: 1px solid var(--border); font-size: 14px; margin-bottom: 8px; }
        .actions { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
        .btn { padding: 10px 14px; border-radius: 8px; border: none; cursor: pointer; font-weight: 700; letter-spacing: 0.3px; transition: transform 0.1s ease, box-shadow 0.15s ease; }
        .btn.primary { background: linear-gradient(135deg, var(--secondary), var(--accent)); color: white; box-shadow: 0 12px 24px rgba(0, 150, 199, 0.25); }
        .btn.secondary { background: white; color: var(--secondary); border: 1px solid var(--border); }
        .btn:hover { transform: translateY(-1px); }
        table { width: 100%; border-collapse: collapse; margin-top: 8px; }
        th, td { border: 1px solid var(--border); padding: 10px 12px; font-size: 14px; vertical-align: top; }
        th { background: #f0f7fb; color: #2b4c63; text-transform: uppercase; letter-spacing: 0.4px; font-weight: 800; }
        .badge { padding: 3px 8px; background: var(--muted); border-radius: 999px; border: 1px solid var(--border); font-size: 11px; color: #2b4c63; }
        .backup-card { border: 1px dashed var(--border); padding: 12px 14px; border-radius: 10px; background: #f8fbff; margin: 12px 0; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .backup-card p { margin: 0; color: #2b4c63; font-weight: 600; }
        @media (max-width: 900px) { body { padding: 12px; } .page { padding: 20px; } }
    </style>
</head>
<body>
    <div class="page">
        <div class="top-bar">
            <div class="brand">
                <div class="brand-mark">IQ</div>
                <div class="brand-name">
                    <h3>INQUISERCO</h3>
                    <small>Ingeniería Química y Servicios</small>
                </div>
            </div>
            <h2 style="color: var(--secondary);">Artículos</h2>
        </div>

        <nav>
            <a href="index.html">Cotización</a>
            <a href="cotizaciones.html">Cotizaciones</a>
            <a class="active" href="articulos.html">Artículos</a>
            <a href="clientes.html">Clientes</a>
        </nav>

        <div class="backup-card">
            <p>Guarda un respaldo de artículos, clientes y cotizaciones para restaurarlo luego.</p>
            <div class="actions">
                <button class="btn secondary" onclick="exportarDatos()">Exportar respaldo</button>
                <label class="btn primary" style="cursor:pointer;" for="importBackup">Importar respaldo</label>
                <input id="importBackup" type="file" accept="application/json" style="display:none" />
            </div>
        </div>

        <div class="section-title">Gestión de artículos</div>
        <div class="info-card">
            <div class="mini-form">
                <label>Código</label>
                <input id="articuloCodigo" type="text" placeholder="Código interno" />
                <label>Descripción</label>
                <input id="articuloNombre" type="text" placeholder="Nombre o descripción" />
                <label>Precio de compra</label>
                <input id="articuloCompra" type="number" min="0" step="0.01" placeholder="0" />
                <label>Precio de venta</label>
                <input id="articuloVenta" type="number" min="0" step="0.01" placeholder="0" />
                <div class="actions">
                    <button class="btn secondary" onclick="limpiarArticulo()">Limpiar</button>
                    <button class="btn primary" onclick="guardarArticulo()">Guardar artículo</button>
                </div>
            </div>
            <div style="margin-top:12px; display:flex; justify-content: space-between; align-items:center;">
                <strong>Lista de artículos</strong>
                <span class="badge" id="articulosCount">0 registrados</span>
            </div>
            <table id="tablaArticulos">
                <thead>
                    <tr><th>Código</th><th>Descripción</th><th>Compra</th><th>Venta</th><th>Acciones</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        const storage = {
            articulos: "inquiserco_articulos",
            clientes: "inquiserco_clientes",
            cotizaciones: "inquiserco_cotizaciones",
            consecutivo: "inquiserco_consecutivo",
        };
        const data = { articulos: JSON.parse(localStorage.getItem(storage.articulos) || "[]") };
        let articuloEditando = null;

        const formatCurrency = value => new Intl.NumberFormat("es-CO", { style: "currency", currency: "COP", minimumFractionDigits: 0 }).format(value);

        const persistir = (key, value) => localStorage.setItem(key, JSON.stringify(value));

        function exportarDatos() {
            const snapshot = {
                version: 1,
                generado: new Date().toISOString(),
                articulos: JSON.parse(localStorage.getItem(storage.articulos) || "[]"),
                clientes: JSON.parse(localStorage.getItem(storage.clientes) || "[]"),
                cotizaciones: JSON.parse(localStorage.getItem(storage.cotizaciones) || "[]"),
                consecutivo: parseInt(localStorage.getItem(storage.consecutivo) || "113", 10),
            };
            const blob = new Blob([JSON.stringify(snapshot, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = `inquiserco-respaldo-${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function restaurarDesdeBackup(contenido) {
            if (!Array.isArray(contenido.articulos) || !Array.isArray(contenido.clientes) || !Array.isArray(contenido.cotizaciones)) {
                alert("El archivo no tiene el formato esperado.");
                return;
            }
            data.articulos = contenido.articulos;
            persistir(storage.articulos, data.articulos);
            if (contenido.clientes) persistir(storage.clientes, contenido.clientes);
            if (contenido.cotizaciones) persistir(storage.cotizaciones, contenido.cotizaciones);
            if (Number.isFinite(contenido.consecutivo)) {
                localStorage.setItem(storage.consecutivo, contenido.consecutivo);
            }
            renderArticulos();
            alert("Datos importados correctamente.");
        }

        document.getElementById("importBackup").addEventListener("change", event => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const contenido = JSON.parse(e.target.result);
                    restaurarDesdeBackup(contenido);
                } catch (error) {
                    alert("No se pudo leer el archivo de respaldo.");
                }
            };
            reader.readAsText(file);
            event.target.value = "";
        });

        function renderArticulos() {
            const tbody = document.querySelector("#tablaArticulos tbody");
            tbody.innerHTML = "";
            data.articulos.forEach((articulo, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${articulo.codigo || "-"}</td>
                    <td>${articulo.nombre}</td>
                    <td style=\"text-align:right;\">${formatCurrency(articulo.compra)}</td>
                    <td style=\"text-align:right;\">${formatCurrency(articulo.venta)}</td>
                    <td style=\"text-align:center;\">
                        <button class=\"btn secondary\" style=\"padding:6px 10px;font-size:12px;\" onclick=\"editarArticulo(${index})\">Editar</button>
                        <button class=\"btn secondary\" style=\"padding:6px 10px;font-size:12px;\" onclick=\"eliminarArticulo(${index})\">Borrar</button>
                    </td>`;
                tbody.appendChild(row);
            });
            document.getElementById("articulosCount").textContent = `${data.articulos.length} registrados`;
        }

        function guardarArticulo() {
            const codigo = document.getElementById("articuloCodigo").value.trim();
            const nombre = document.getElementById("articuloNombre").value.trim();
            const compra = parseFloat(document.getElementById("articuloCompra").value);
            const venta = parseFloat(document.getElementById("articuloVenta").value);
            if (!nombre || Number.isNaN(compra) || Number.isNaN(venta)) {
                alert("Completa los datos del artículo.");
                return;
            }
            const nuevo = { codigo, nombre, compra, venta };
            if (articuloEditando !== null) {
                data.articulos[articuloEditando] = nuevo;
            } else {
                data.articulos.push(nuevo);
            }
            persistir(storage.articulos, data.articulos);
            renderArticulos();
            limpiarArticulo();
        }

        function limpiarArticulo() {
            articuloEditando = null;
            document.getElementById("articuloCodigo").value = "";
            document.getElementById("articuloNombre").value = "";
            document.getElementById("articuloCompra").value = "";
            document.getElementById("articuloVenta").value = "";
        }

        function editarArticulo(index) {
            articuloEditando = index;
            const articulo = data.articulos[index];
            document.getElementById("articuloCodigo").value = articulo.codigo;
            document.getElementById("articuloNombre").value = articulo.nombre;
            document.getElementById("articuloCompra").value = articulo.compra;
            document.getElementById("articuloVenta").value = articulo.venta;
        }

        function eliminarArticulo(index) {
            if (!confirm("¿Eliminar este artículo?")) return;
            data.articulos.splice(index, 1);
            persistir(storage.articulos, data.articulos);
            renderArticulos();
        }

        renderArticulos();
    </script>
</body>
</html>
